!function(a,b){"use strict";"undefined"!=typeof exports?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a)}(this,function(a){"use strict";var b="CEROS_SCROLL_PROXY_LOADED";if(!window[b]){window[b]=!0;for(var c="ceros-embedded-viewport:",d={PING:"ping",READY:"ready",POSITION:"position",SCROLL_TO:"scroll-to",GOTO_URL:"goto-url"},e=[],f=function(a){var b=a.getBoundingClientRect(),c={top:-b.top,bottom:window.innerHeight-b.top};m(a,d.POSITION,c)},g=function(){for(var a=0;a<e.length;a++)f(e[a])},h=function(a,b){for(var c=null,d=0;d<a.length;d++)if(a[d].contentWindow===b){c=a[d];break}return c},i=function(a){var b=h(document.getElementsByTagName("iframe"),a);b&&(e.push(b),f(b))},j=function(a,b){var c=h(e,a);if(c){var d=Math.max(0,b.scrollPosition-b.pageHeight+b.visibleHeight),f=c.getBoundingClientRect(),g=window.pageYOffset+f.top,i=window.pageYOffset+f.bottom,j=f.bottom-f.top,k=d*j/b.visibleHeight,l=i-window.innerHeight;window.scroll(0,Math.min(k+g,l))}},k=function(a,b){b.urlOpenInNewWindow?window.open(b.url):window.location=b.url},l=function(a){var b,e;try{b=JSON.parse(a.data),e=b&&b.event&&b.event.substr(0,c.length)===c}catch(f){return}if(e)switch(b.event.substr(c.length)){case d.READY:i(a.source);break;case d.SCROLL_TO:j(a.source,b);break;case d.GOTO_URL:k(a.source,b)}},m=function(a,b,d){var e={event:c+b};if(d)for(var f in d)d.hasOwnProperty(f)&&(e[f]=d[f]);var g=JSON.stringify(e);a.contentWindow.postMessage(g,"*")},n=document.getElementsByTagName("iframe"),o=0;o<n.length;o++)e.indexOf(-1===n[o])&&m(n[o],d.PING);window.sendViewportPositionEvent=f,window.addEventListener("message",l),window.addEventListener("scroll",g),window.addEventListener("resize",g)}});